                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.1.0 #12072 (Mac OS X ppc)
                                      4 ;--------------------------------------------------------
                                      5 	.module usbdisk
                                      6 	.optsdcc -mz80
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _toUpper
                                     12 	.globl _toLower
                                     13 	.globl _supports_80_column_mode
                                     14 	.globl _error
                                     15 	.globl _delay_ms
                                     16 	.globl _pressed_ESC
                                     17 	.globl _getchar
                                     18 	.globl _putchar
                                     19 	.globl _ch376s_disk_write
                                     20 	.globl _ch376s_disk_read
                                     21 	.globl _ch376_get_sector_LBA
                                     22 	.globl _ch376_locate_sector
                                     23 	.globl _ch376_get_fat_info
                                     24 	.globl _ch376_next_search
                                     25 	.globl _ch376_open_search
                                     26 	.globl _ch376_set_filename
                                     27 	.globl _ch376_open_directory
                                     28 	.globl _ch376_close_file
                                     29 	.globl _ch376_open_file
                                     30 	.globl _ch376_mount_disk
                                     31 	.globl _ch376_connect_disk
                                     32 	.globl _ch376_set_usb_host_mode
                                     33 	.globl _ch376_plugged_in
                                     34 	.globl _ch376_reset_all
                                     35 	.globl _toupper
                                     36 	.globl _tolower
                                     37 	.globl _puts
                                     38 	.globl _printf
                                     39 	.globl _usbdisk_init
                                     40 	.globl _usbdisk_autoexec_dsk
                                     41 	.globl _usbdisk_select_dsk_file
                                     42 	.globl _read_write_file_sectors
                                     43 	.globl _read_write_disk_sectors
                                     44 	.globl _usbdisk_close_dsk_file
                                     45 ;--------------------------------------------------------
                                     46 ; special function registers
                                     47 ;--------------------------------------------------------
                                     48 ;--------------------------------------------------------
                                     49 ; ram data
                                     50 ;--------------------------------------------------------
                                     51 	.area _DATA
                                     52 ;--------------------------------------------------------
                                     53 ; ram data
                                     54 ;--------------------------------------------------------
                                     55 	.area _INITIALIZED
                                     56 ;--------------------------------------------------------
                                     57 ; absolute external ram data
                                     58 ;--------------------------------------------------------
                                     59 	.area _DABS (ABS)
                                     60 ;--------------------------------------------------------
                                     61 ; global & static initialisations
                                     62 ;--------------------------------------------------------
                                     63 	.area _HOME
                                     64 	.area _GSINIT
                                     65 	.area _GSFINAL
                                     66 	.area _GSINIT
                                     67 ;--------------------------------------------------------
                                     68 ; Home
                                     69 ;--------------------------------------------------------
                                     70 	.area _HOME
                                     71 	.area _HOME
                                     72 ;--------------------------------------------------------
                                     73 ; code
                                     74 ;--------------------------------------------------------
                                     75 	.area _CODE
                                     76 ;../generic/usbdisk.c:11: void usbdisk_init ()
                                     77 ;	---------------------------------
                                     78 ; Function usbdisk_init
                                     79 ; ---------------------------------
      000000                         80 _usbdisk_init::
                                     81 ;../generic/usbdisk.c:13: printf ("MSXUSB-NXT v0.3 (c)Sourceror\r\n");
      000000 21r40r00         [10]   82 	ld	hl, #___str_1
      000003 E5               [11]   83 	push	hl
      000004 CDr00r00         [17]   84 	call	_puts
      000007 F1               [10]   85 	pop	af
                                     86 ;../generic/usbdisk.c:14: ch376_reset_all();
      000008 CDr00r00         [17]   87 	call	_ch376_reset_all
                                     88 ;../generic/usbdisk.c:15: if (!ch376_plugged_in())
      00000B CDr00r00         [17]   89 	call	_ch376_plugged_in
      00000E CB 45            [ 8]   90 	bit	0, l
      000010 20 08            [12]   91 	jr	NZ, 00102$
                                     92 ;../generic/usbdisk.c:16: error ("-CH376 NOT detected");
      000012 21r5Er00         [10]   93 	ld	hl, #___str_2
      000015 E5               [11]   94 	push	hl
      000016 CDr00r00         [17]   95 	call	_error
      000019 F1               [10]   96 	pop	af
      00001A                         97 00102$:
                                     98 ;../generic/usbdisk.c:18: ch376_set_usb_host_mode(USB_MODE_HOST);
      00001A 3E 06            [ 7]   99 	ld	a, #0x06
      00001C F5               [11]  100 	push	af
      00001D 33               [ 6]  101 	inc	sp
      00001E CDr00r00         [17]  102 	call	_ch376_set_usb_host_mode
      000021 33               [ 6]  103 	inc	sp
                                    104 ;../generic/usbdisk.c:19: if (!ch376_connect_disk ())
      000022 CDr00r00         [17]  105 	call	_ch376_connect_disk
      000025 CB 45            [ 8]  106 	bit	0, l
      000027 20 08            [12]  107 	jr	NZ, 00104$
                                    108 ;../generic/usbdisk.c:20: error ("-Connect USB device");
      000029 21r72r00         [10]  109 	ld	hl, #___str_3
      00002C E5               [11]  110 	push	hl
      00002D CDr00r00         [17]  111 	call	_error
      000030 F1               [10]  112 	pop	af
      000031                        113 00104$:
                                    114 ;../generic/usbdisk.c:22: if (!ch376_mount_disk ())
      000031 CDr00r00         [17]  115 	call	_ch376_mount_disk
      000034 CB 45            [ 8]  116 	bit	0, l
      000036 C0               [11]  117 	ret	NZ
                                    118 ;../generic/usbdisk.c:23: error ("-Not a valid disk");
      000037 21r86r00         [10]  119 	ld	hl, #___str_4
      00003A E5               [11]  120 	push	hl
      00003B CDr00r00         [17]  121 	call	_error
      00003E F1               [10]  122 	pop	af
                                    123 ;../generic/usbdisk.c:25: }
      00003F C9               [10]  124 	ret
      000040                        125 ___str_1:
      000040 4D 53 58 55 53 42 2D   126 	.ascii "MSXUSB-NXT v0.3 (c)Sourceror"
             4E 58 54 20 76 30 2E
             33 20 28 63 29 53 6F
             75 72 63 65 72 6F 72
      00005C 0D                     127 	.db 0x0d
      00005D 00                     128 	.db 0x00
      00005E                        129 ___str_2:
      00005E 2D 43 48 33 37 36 20   130 	.ascii "-CH376 NOT detected"
             4E 4F 54 20 64 65 74
             65 63 74 65 64
      000071 00                     131 	.db 0x00
      000072                        132 ___str_3:
      000072 2D 43 6F 6E 6E 65 63   133 	.ascii "-Connect USB device"
             74 20 55 53 42 20 64
             65 76 69 63 65
      000085 00                     134 	.db 0x00
      000086                        135 ___str_4:
      000086 2D 4E 6F 74 20 61 20   136 	.ascii "-Not a valid disk"
             76 61 6C 69 64 20 64
             69 73 6B
      000097 00                     137 	.db 0x00
                                    138 ;../generic/usbdisk.c:27: char* toLower(char* s) {
                                    139 ;	---------------------------------
                                    140 ; Function toLower
                                    141 ; ---------------------------------
      000098                        142 _toLower::
                                    143 ;../generic/usbdisk.c:28: for(char *p=s; *p; p++) *p=tolower(*p);
      000098 D1               [10]  144 	pop	de
      000099 C1               [10]  145 	pop	bc
      00009A C5               [11]  146 	push	bc
      00009B D5               [11]  147 	push	de
      00009C                        148 00103$:
      00009C 0A               [ 7]  149 	ld	a, (bc)
      00009D B7               [ 4]  150 	or	a, a
      00009E 28 0F            [12]  151 	jr	Z, 00101$
      0000A0 5F               [ 4]  152 	ld	e, a
      0000A1 16 00            [ 7]  153 	ld	d, #0x00
      0000A3 C5               [11]  154 	push	bc
      0000A4 D5               [11]  155 	push	de
      0000A5 CDr00r00         [17]  156 	call	_tolower
      0000A8 F1               [10]  157 	pop	af
      0000A9 C1               [10]  158 	pop	bc
      0000AA 7D               [ 4]  159 	ld	a, l
      0000AB 02               [ 7]  160 	ld	(bc), a
      0000AC 03               [ 6]  161 	inc	bc
      0000AD 18 ED            [12]  162 	jr	00103$
      0000AF                        163 00101$:
                                    164 ;../generic/usbdisk.c:29: return s;
      0000AF 21 02 00         [10]  165 	ld	hl, #2
      0000B2 39               [11]  166 	add	hl, sp
      0000B3 7E               [ 7]  167 	ld	a, (hl)
      0000B4 23               [ 6]  168 	inc	hl
      0000B5 66               [ 7]  169 	ld	h, (hl)
      0000B6 6F               [ 4]  170 	ld	l, a
                                    171 ;../generic/usbdisk.c:30: }
      0000B7 C9               [10]  172 	ret
                                    173 ;../generic/usbdisk.c:31: char* toUpper(char* s) {
                                    174 ;	---------------------------------
                                    175 ; Function toUpper
                                    176 ; ---------------------------------
      0000B8                        177 _toUpper::
                                    178 ;../generic/usbdisk.c:32: for(char *p=s; *p; p++) *p=toupper(*p);
      0000B8 D1               [10]  179 	pop	de
      0000B9 C1               [10]  180 	pop	bc
      0000BA C5               [11]  181 	push	bc
      0000BB D5               [11]  182 	push	de
      0000BC                        183 00103$:
      0000BC 0A               [ 7]  184 	ld	a, (bc)
      0000BD B7               [ 4]  185 	or	a, a
      0000BE 28 0F            [12]  186 	jr	Z, 00101$
      0000C0 5F               [ 4]  187 	ld	e, a
      0000C1 16 00            [ 7]  188 	ld	d, #0x00
      0000C3 C5               [11]  189 	push	bc
      0000C4 D5               [11]  190 	push	de
      0000C5 CDr00r00         [17]  191 	call	_toupper
      0000C8 F1               [10]  192 	pop	af
      0000C9 C1               [10]  193 	pop	bc
      0000CA 7D               [ 4]  194 	ld	a, l
      0000CB 02               [ 7]  195 	ld	(bc), a
      0000CC 03               [ 6]  196 	inc	bc
      0000CD 18 ED            [12]  197 	jr	00103$
      0000CF                        198 00101$:
                                    199 ;../generic/usbdisk.c:33: return s;
      0000CF 21 02 00         [10]  200 	ld	hl, #2
      0000D2 39               [11]  201 	add	hl, sp
      0000D3 7E               [ 7]  202 	ld	a, (hl)
      0000D4 23               [ 6]  203 	inc	hl
      0000D5 66               [ 7]  204 	ld	h, (hl)
      0000D6 6F               [ 4]  205 	ld	l, a
                                    206 ;../generic/usbdisk.c:34: }
      0000D7 C9               [10]  207 	ret
                                    208 ;../generic/usbdisk.c:36: bool usbdisk_autoexec_dsk()
                                    209 ;	---------------------------------
                                    210 ; Function usbdisk_autoexec_dsk
                                    211 ; ---------------------------------
      0000D8                        212 _usbdisk_autoexec_dsk::
                                    213 ;../generic/usbdisk.c:41: ch376_set_filename ("/");
      0000D8 21r3Fr01         [10]  214 	ld	hl, #___str_5
      0000DB E5               [11]  215 	push	hl
      0000DC CDr00r00         [17]  216 	call	_ch376_set_filename
      0000DF F1               [10]  217 	pop	af
                                    218 ;../generic/usbdisk.c:42: if (!ch376_open_directory())
      0000E0 CDr00r00         [17]  219 	call	_ch376_open_directory
      0000E3 CB 45            [ 8]  220 	bit	0, l
      0000E5 20 08            [12]  221 	jr	NZ, 00102$
                                    222 ;../generic/usbdisk.c:44: error ("-Directory not opened");
      0000E7 21r41r01         [10]  223 	ld	hl, #___str_6
      0000EA E5               [11]  224 	push	hl
      0000EB CDr00r00         [17]  225 	call	_error
      0000EE F1               [10]  226 	pop	af
      0000EF                        227 00102$:
                                    228 ;../generic/usbdisk.c:48: ch376_set_filename ("AUTOEXEC.DSK");
      0000EF 21r57r01         [10]  229 	ld	hl, #___str_7
      0000F2 E5               [11]  230 	push	hl
      0000F3 CDr00r00         [17]  231 	call	_ch376_set_filename
      0000F6 F1               [10]  232 	pop	af
                                    233 ;../generic/usbdisk.c:49: if (ch376_open_file())
      0000F7 CDr00r00         [17]  234 	call	_ch376_open_file
      0000FA CB 45            [ 8]  235 	bit	0, l
      0000FC 28 3E            [12]  236 	jr	Z, 00110$
                                    237 ;../generic/usbdisk.c:51: printf ("\r\nStarting AUTOEXEC.DSK or press ESC ");
      0000FE 21r64r01         [10]  238 	ld	hl, #___str_8
      000101 E5               [11]  239 	push	hl
      000102 CDr00r00         [17]  240 	call	_printf
      000105 F1               [10]  241 	pop	af
                                    242 ;../generic/usbdisk.c:52: for (cnt_times=3;cnt_times>0;cnt_times--)
      000106 01 03 03         [10]  243 	ld	bc, #0x0303
      000109                        244 00111$:
                                    245 ;../generic/usbdisk.c:54: delay_ms (1000);
      000109 C5               [11]  246 	push	bc
      00010A 21 E8 03         [10]  247 	ld	hl, #0x03e8
      00010D E5               [11]  248 	push	hl
      00010E CDr00r00         [17]  249 	call	_delay_ms
      000111 F1               [10]  250 	pop	af
      000112 CDr00r00         [17]  251 	call	_pressed_ESC
      000115 C1               [10]  252 	pop	bc
      000116 CB 45            [ 8]  253 	bit	0, l
      000118 20 10            [12]  254 	jr	NZ, 00105$
                                    255 ;../generic/usbdisk.c:57: printf (".");
      00011A C5               [11]  256 	push	bc
      00011B 21r8Ar01         [10]  257 	ld	hl, #___str_9
      00011E E5               [11]  258 	push	hl
      00011F CDr00r00         [17]  259 	call	_printf
      000122 F1               [10]  260 	pop	af
      000123 C1               [10]  261 	pop	bc
                                    262 ;../generic/usbdisk.c:52: for (cnt_times=3;cnt_times>0;cnt_times--)
      000124 0D               [ 4]  263 	dec	c
      000125 41               [ 4]  264 	ld	b, c
      000126 79               [ 4]  265 	ld	a, c
      000127 B7               [ 4]  266 	or	a, a
      000128 20 DF            [12]  267 	jr	NZ, 00111$
      00012A                        268 00105$:
                                    269 ;../generic/usbdisk.c:59: if (cnt_times==0)
      00012A 78               [ 4]  270 	ld	a, b
      00012B B7               [ 4]  271 	or	a, a
      00012C 20 0B            [12]  272 	jr	NZ, 00107$
                                    273 ;../generic/usbdisk.c:61: printf ("\r\n");
      00012E 21r8Cr01         [10]  274 	ld	hl, #___str_11
      000131 E5               [11]  275 	push	hl
      000132 CDr00r00         [17]  276 	call	_puts
      000135 F1               [10]  277 	pop	af
                                    278 ;../generic/usbdisk.c:62: return true;
      000136 2E 01            [ 7]  279 	ld	l, #0x01
      000138 C9               [10]  280 	ret
      000139                        281 00107$:
                                    282 ;../generic/usbdisk.c:66: ch376_close_file ();
      000139 CDr00r00         [17]  283 	call	_ch376_close_file
      00013C                        284 00110$:
                                    285 ;../generic/usbdisk.c:69: return false;
      00013C 2E 00            [ 7]  286 	ld	l, #0x00
                                    287 ;../generic/usbdisk.c:70: }
      00013E C9               [10]  288 	ret
      00013F                        289 ___str_5:
      00013F 2F                     290 	.ascii "/"
      000140 00                     291 	.db 0x00
      000141                        292 ___str_6:
      000141 2D 44 69 72 65 63 74   293 	.ascii "-Directory not opened"
             6F 72 79 20 6E 6F 74
             20 6F 70 65 6E 65 64
      000156 00                     294 	.db 0x00
      000157                        295 ___str_7:
      000157 41 55 54 4F 45 58 45   296 	.ascii "AUTOEXEC.DSK"
             43 2E 44 53 4B
      000163 00                     297 	.db 0x00
      000164                        298 ___str_8:
      000164 0D                     299 	.db 0x0d
      000165 0A                     300 	.db 0x0a
      000166 53 74 61 72 74 69 6E   301 	.ascii "Starting AUTOEXEC.DSK or press ESC "
             67 20 41 55 54 4F 45
             58 45 43 2E 44 53 4B
             20 6F 72 20 70 72 65
             73 73 20 45 53 43 20
      000189 00                     302 	.db 0x00
      00018A                        303 ___str_9:
      00018A 2E                     304 	.ascii "."
      00018B 00                     305 	.db 0x00
      00018C                        306 ___str_11:
      00018C 0D                     307 	.db 0x0d
      00018D 00                     308 	.db 0x00
                                    309 ;../generic/usbdisk.c:73: select_mode_t usbdisk_select_dsk_file (char* start_directory)
                                    310 ;	---------------------------------
                                    311 ; Function usbdisk_select_dsk_file
                                    312 ; ---------------------------------
      00018E                        313 _usbdisk_select_dsk_file::
      00018E DD E5            [15]  314 	push	ix
      000190 DD 21 00 00      [14]  315 	ld	ix,#0
      000194 DD 39            [15]  316 	add	ix,sp
      000196 21 92 FE         [10]  317 	ld	hl, #-366
      000199 39               [11]  318 	add	hl, sp
      00019A F9               [ 6]  319 	ld	sp, hl
                                    320 ;../generic/usbdisk.c:81: if (supports_80_column_mode())
      00019B CDr00r00         [17]  321 	call	_supports_80_column_mode
      00019E CB 45            [ 8]  322 	bit	0, l
      0001A0 28 06            [12]  323 	jr	Z, 00102$
                                    324 ;../generic/usbdisk.c:82: nr_dsks_per_line = 5;
      0001A2 DD 36 F3 05      [19]  325 	ld	-13 (ix), #0x05
      0001A6 18 04            [12]  326 	jr	00103$
      0001A8                        327 00102$:
                                    328 ;../generic/usbdisk.c:84: nr_dsks_per_line = 2;
      0001A8 DD 36 F3 02      [19]  329 	ld	-13 (ix), #0x02
      0001AC                        330 00103$:
                                    331 ;../generic/usbdisk.c:86: nr_dsk_files_found=0;
      0001AC DD 36 FE 00      [19]  332 	ld	-2 (ix), #0
                                    333 ;../generic/usbdisk.c:89: ch376_set_filename (start_directory);
      0001B0 DD 6E 04         [19]  334 	ld	l, 4 (ix)
      0001B3 DD 66 05         [19]  335 	ld	h, 5 (ix)
      0001B6 E5               [11]  336 	push	hl
      0001B7 CDr00r00         [17]  337 	call	_ch376_set_filename
      0001BA F1               [10]  338 	pop	af
                                    339 ;../generic/usbdisk.c:90: if (!ch376_open_directory())
      0001BB CDr00r00         [17]  340 	call	_ch376_open_directory
      0001BE CB 45            [ 8]  341 	bit	0, l
      0001C0 20 08            [12]  342 	jr	NZ, 00105$
                                    343 ;../generic/usbdisk.c:92: error ("-Directory not opened");
      0001C2 21rAFr04         [10]  344 	ld	hl, #___str_12
      0001C5 E5               [11]  345 	push	hl
      0001C6 CDr00r00         [17]  346 	call	_error
      0001C9 F1               [10]  347 	pop	af
      0001CA                        348 00105$:
                                    349 ;../generic/usbdisk.c:97: printf ("1.FLOPPY       2.USBDRIVE\r\n\r\n");
      0001CA 21r0Ar05         [10]  350 	ld	hl, #___str_24
      0001CD E5               [11]  351 	push	hl
      0001CE CDr00r00         [17]  352 	call	_puts
                                    353 ;../generic/usbdisk.c:100: ch376_set_filename ("*");
      0001D1 21rC5r04         [10]  354 	ld	hl, #___str_17
      0001D4 E3               [19]  355 	ex	(sp),hl
      0001D5 CDr00r00         [17]  356 	call	_ch376_set_filename
      0001D8 F1               [10]  357 	pop	af
                                    358 ;../generic/usbdisk.c:101: if (!ch376_open_search ())
      0001D9 CDr00r00         [17]  359 	call	_ch376_open_search
      0001DC CB 45            [ 8]  360 	bit	0, l
      0001DE 20 08            [12]  361 	jr	NZ, 00107$
                                    362 ;../generic/usbdisk.c:102: error ("-No files found");
      0001E0 21rC7r04         [10]  363 	ld	hl, #___str_18
      0001E3 E5               [11]  364 	push	hl
      0001E4 CDr00r00         [17]  365 	call	_error
      0001E7 F1               [10]  366 	pop	af
      0001E8                        367 00107$:
                                    368 ;../generic/usbdisk.c:104: printf ("Or, select DSK image [%s]:\r\n",start_directory);
      0001E8 DD 6E 04         [19]  369 	ld	l, 4 (ix)
      0001EB DD 66 05         [19]  370 	ld	h, 5 (ix)
      0001EE E5               [11]  371 	push	hl
      0001EF 21rD7r04         [10]  372 	ld	hl, #___str_19
      0001F2 E5               [11]  373 	push	hl
      0001F3 CDr00r00         [17]  374 	call	_printf
      0001F6 F1               [10]  375 	pop	af
      0001F7 F1               [10]  376 	pop	af
                                    377 ;../generic/usbdisk.c:106: do 
      0001F8 21 20 00         [10]  378 	ld	hl, #32
      0001FB 39               [11]  379 	add	hl, sp
      0001FC 4D               [ 4]  380 	ld	c, l
      0001FD 44               [ 4]  381 	ld	b, h
      0001FE DD 71 F4         [19]  382 	ld	-12 (ix), c
      000201 DD 70 F5         [19]  383 	ld	-11 (ix), b
      000204 21 00 00         [10]  384 	ld	hl, #0
      000207 39               [11]  385 	add	hl, sp
      000208 DD 75 F6         [19]  386 	ld	-10 (ix), l
      00020B DD 74 F7         [19]  387 	ld	-9 (ix), h
      00020E DD 7E F6         [19]  388 	ld	a, -10 (ix)
      000211 C6 0B            [ 7]  389 	add	a, #0x0b
      000213 DD 77 F8         [19]  390 	ld	-8 (ix), a
      000216 DD 7E F7         [19]  391 	ld	a, -9 (ix)
      000219 CE 00            [ 7]  392 	adc	a, #0x00
      00021B DD 77 F9         [19]  393 	ld	-7 (ix), a
      00021E                        394 00128$:
                                    395 ;../generic/usbdisk.c:108: ch376_get_fat_info (&info);
      00021E DD 5E F6         [19]  396 	ld	e, -10 (ix)
      000221 DD 56 F7         [19]  397 	ld	d, -9 (ix)
      000224 C5               [11]  398 	push	bc
      000225 D5               [11]  399 	push	de
      000226 CDr00r00         [17]  400 	call	_ch376_get_fat_info
      000229 F1               [10]  401 	pop	af
      00022A C1               [10]  402 	pop	bc
                                    403 ;../generic/usbdisk.c:109: if (!(info.DIR_Attr&0x02)) // show non-hidden normal or archived files
      00022B DD 6E F8         [19]  404 	ld	l, -8 (ix)
      00022E DD 66 F9         [19]  405 	ld	h, -7 (ix)
      000231 7E               [ 7]  406 	ld	a, (hl)
      000232 DD 77 FF         [19]  407 	ld	-1 (ix), a
      000235 DD CB FF 4E      [20]  408 	bit	1, -1 (ix)
      000239 C2rFEr03         [10]  409 	jp	NZ,00129$
                                    410 ;../generic/usbdisk.c:111: if (info.DIR_Attr&0x20 || info.DIR_Attr==0x00)
      00023C DD CB FF 6E      [20]  411 	bit	5, -1 (ix)
      000240 20 07            [12]  412 	jr	NZ, 00117$
      000242 DD 7E FF         [19]  413 	ld	a, -1 (ix)
      000245 B7               [ 4]  414 	or	a, a
      000246 C2r2Ar03         [10]  415 	jp	NZ, 00118$
      000249                        416 00117$:
                                    417 ;../generic/usbdisk.c:113: if (info.DIR_Name[8]=='D' &&
      000249 DD 5E F6         [19]  418 	ld	e, -10 (ix)
      00024C DD 56 F7         [19]  419 	ld	d, -9 (ix)
      00024F 21 08 00         [10]  420 	ld	hl, #8
      000252 19               [11]  421 	add	hl, de
      000253 7E               [ 7]  422 	ld	a, (hl)
      000254 D6 44            [ 7]  423 	sub	a, #0x44
      000256 C2r2Ar03         [10]  424 	jp	NZ,00118$
                                    425 ;../generic/usbdisk.c:114: info.DIR_Name[9]=='S' &&
      000259 DD 5E F6         [19]  426 	ld	e, -10 (ix)
      00025C DD 56 F7         [19]  427 	ld	d, -9 (ix)
      00025F 21 09 00         [10]  428 	ld	hl, #9
      000262 19               [11]  429 	add	hl, de
      000263 7E               [ 7]  430 	ld	a, (hl)
      000264 D6 53            [ 7]  431 	sub	a, #0x53
      000266 C2r2Ar03         [10]  432 	jp	NZ,00118$
                                    433 ;../generic/usbdisk.c:115: info.DIR_Name[10]=='K')
      000269 DD 5E F6         [19]  434 	ld	e, -10 (ix)
      00026C DD 56 F7         [19]  435 	ld	d, -9 (ix)
      00026F 21 0A 00         [10]  436 	ld	hl, #10
      000272 19               [11]  437 	add	hl, de
      000273 7E               [ 7]  438 	ld	a, (hl)
      000274 D6 4B            [ 7]  439 	sub	a, #0x4b
      000276 C2r2Ar03         [10]  440 	jp	NZ,00118$
                                    441 ;../generic/usbdisk.c:117: putchar ('A'+nr_dsk_files_found);
      000279 DD 5E FE         [19]  442 	ld	e, -2 (ix)
      00027C 16 00            [ 7]  443 	ld	d, #0x00
      00027E 21 41 00         [10]  444 	ld	hl, #0x0041
      000281 19               [11]  445 	add	hl, de
      000282 C5               [11]  446 	push	bc
      000283 E5               [11]  447 	push	hl
      000284 CDr00r00         [17]  448 	call	_putchar
      000287 21 2E 00         [10]  449 	ld	hl, #0x002e
      00028A E3               [19]  450 	ex	(sp),hl
      00028B CDr00r00         [17]  451 	call	_putchar
      00028E F1               [10]  452 	pop	af
      00028F C1               [10]  453 	pop	bc
                                    454 ;../generic/usbdisk.c:119: files[nr_dsk_files_found][11]='\0';
      000290 DD 5E FE         [19]  455 	ld	e, -2 (ix)
      000293 16 00            [ 7]  456 	ld	d, #0x00
      000295 6B               [ 4]  457 	ld	l, e
      000296 62               [ 4]  458 	ld	h, d
      000297 29               [11]  459 	add	hl, hl
      000298 19               [11]  460 	add	hl, de
      000299 29               [11]  461 	add	hl, hl
      00029A 29               [11]  462 	add	hl, hl
      00029B 09               [11]  463 	add	hl, bc
      00029C EB               [ 4]  464 	ex	de, hl
      00029D 21 0B 00         [10]  465 	ld	hl, #0x000b
      0002A0 19               [11]  466 	add	hl, de
      0002A1 36 00            [10]  467 	ld	(hl), #0x00
                                    468 ;../generic/usbdisk.c:120: for (cnt=0;cnt<11;cnt++)
      0002A3 DD 73 FA         [19]  469 	ld	-6 (ix), e
      0002A6 DD 72 FB         [19]  470 	ld	-5 (ix), d
      0002A9 DD 36 FF 00      [19]  471 	ld	-1 (ix), #0
      0002AD                        472 00144$:
                                    473 ;../generic/usbdisk.c:122: if (cnt==8)
      0002AD DD 7E FF         [19]  474 	ld	a, -1 (ix)
      0002B0 D6 08            [ 7]  475 	sub	a, #0x08
      0002B2 20 0A            [12]  476 	jr	NZ, 00109$
                                    477 ;../generic/usbdisk.c:123: putchar ('.');
      0002B4 C5               [11]  478 	push	bc
      0002B5 21 2E 00         [10]  479 	ld	hl, #0x002e
      0002B8 E5               [11]  480 	push	hl
      0002B9 CDr00r00         [17]  481 	call	_putchar
      0002BC F1               [10]  482 	pop	af
      0002BD C1               [10]  483 	pop	bc
      0002BE                        484 00109$:
                                    485 ;../generic/usbdisk.c:124: putchar (info.DIR_Name[cnt]);
      0002BE DD 7E F6         [19]  486 	ld	a, -10 (ix)
      0002C1 DD 86 FF         [19]  487 	add	a, -1 (ix)
      0002C4 5F               [ 4]  488 	ld	e, a
      0002C5 DD 7E F7         [19]  489 	ld	a, -9 (ix)
      0002C8 CE 00            [ 7]  490 	adc	a, #0x00
      0002CA 57               [ 4]  491 	ld	d, a
      0002CB 1A               [ 7]  492 	ld	a, (de)
      0002CC 6F               [ 4]  493 	ld	l, a
      0002CD 26 00            [ 7]  494 	ld	h, #0x00
      0002CF C5               [11]  495 	push	bc
      0002D0 D5               [11]  496 	push	de
      0002D1 E5               [11]  497 	push	hl
      0002D2 CDr00r00         [17]  498 	call	_putchar
      0002D5 F1               [10]  499 	pop	af
      0002D6 D1               [10]  500 	pop	de
      0002D7 C1               [10]  501 	pop	bc
                                    502 ;../generic/usbdisk.c:125: files[nr_dsk_files_found][cnt]=info.DIR_Name[cnt];
      0002D8 DD 7E FA         [19]  503 	ld	a, -6 (ix)
      0002DB DD 86 FF         [19]  504 	add	a, -1 (ix)
      0002DE DD 77 FC         [19]  505 	ld	-4 (ix), a
      0002E1 DD 7E FB         [19]  506 	ld	a, -5 (ix)
      0002E4 CE 00            [ 7]  507 	adc	a, #0x00
      0002E6 DD 77 FD         [19]  508 	ld	-3 (ix), a
      0002E9 1A               [ 7]  509 	ld	a, (de)
      0002EA DD 6E FC         [19]  510 	ld	l, -4 (ix)
      0002ED DD 66 FD         [19]  511 	ld	h, -3 (ix)
      0002F0 77               [ 7]  512 	ld	(hl), a
                                    513 ;../generic/usbdisk.c:120: for (cnt=0;cnt<11;cnt++)
      0002F1 DD 34 FF         [23]  514 	inc	-1 (ix)
      0002F4 DD 7E FF         [19]  515 	ld	a, -1 (ix)
      0002F7 D6 0B            [ 7]  516 	sub	a, #0x0b
      0002F9 38 B2            [12]  517 	jr	C, 00144$
                                    518 ;../generic/usbdisk.c:127: putchar (' ');
      0002FB C5               [11]  519 	push	bc
      0002FC 21 20 00         [10]  520 	ld	hl, #0x0020
      0002FF E5               [11]  521 	push	hl
      000300 CDr00r00         [17]  522 	call	_putchar
      000303 F1               [10]  523 	pop	af
      000304 C1               [10]  524 	pop	bc
                                    525 ;../generic/usbdisk.c:128: nr_dsk_files_found++;
      000305 DD 34 FE         [23]  526 	inc	-2 (ix)
                                    527 ;../generic/usbdisk.c:129: if ((nr_dsk_files_found%nr_dsks_per_line) == 0)
      000308 C5               [11]  528 	push	bc
      000309 DD 66 F3         [19]  529 	ld	h, -13 (ix)
      00030C DD 6E FE         [19]  530 	ld	l, -2 (ix)
      00030F E5               [11]  531 	push	hl
      000310 CDr00r00         [17]  532 	call	__moduchar
      000313 F1               [10]  533 	pop	af
      000314 7D               [ 4]  534 	ld	a, l
      000315 C1               [10]  535 	pop	bc
      000316 B7               [ 4]  536 	or	a, a
      000317 20 11            [12]  537 	jr	NZ, 00118$
                                    538 ;../generic/usbdisk.c:131: putchar ('\r');
      000319 C5               [11]  539 	push	bc
      00031A 21 0D 00         [10]  540 	ld	hl, #0x000d
      00031D E5               [11]  541 	push	hl
      00031E CDr00r00         [17]  542 	call	_putchar
      000321 21 0A 00         [10]  543 	ld	hl, #0x000a
      000324 E3               [19]  544 	ex	(sp),hl
      000325 CDr00r00         [17]  545 	call	_putchar
      000328 F1               [10]  546 	pop	af
      000329 C1               [10]  547 	pop	bc
      00032A                        548 00118$:
                                    549 ;../generic/usbdisk.c:136: if (info.DIR_Attr&0x10)
      00032A DD 6E F8         [19]  550 	ld	l, -8 (ix)
      00032D DD 66 F9         [19]  551 	ld	h, -7 (ix)
      000330 CB 66            [12]  552 	bit	4, (hl)
      000332 CArFEr03         [10]  553 	jp	Z,00129$
                                    554 ;../generic/usbdisk.c:138: putchar ('A'+nr_dsk_files_found);
      000335 DD 5E FE         [19]  555 	ld	e, -2 (ix)
      000338 16 00            [ 7]  556 	ld	d, #0x00
      00033A 21 41 00         [10]  557 	ld	hl, #0x0041
      00033D 19               [11]  558 	add	hl, de
      00033E C5               [11]  559 	push	bc
      00033F E5               [11]  560 	push	hl
      000340 CDr00r00         [17]  561 	call	_putchar
      000343 21 2E 00         [10]  562 	ld	hl, #0x002e
      000346 E3               [19]  563 	ex	(sp),hl
      000347 CDr00r00         [17]  564 	call	_putchar
      00034A 21 5C 00         [10]  565 	ld	hl, #0x005c
      00034D E3               [19]  566 	ex	(sp),hl
      00034E CDr00r00         [17]  567 	call	_putchar
      000351 F1               [10]  568 	pop	af
      000352 C1               [10]  569 	pop	bc
                                    570 ;../generic/usbdisk.c:141: files[nr_dsk_files_found][8]='\0';
      000353 DD 5E FE         [19]  571 	ld	e, -2 (ix)
      000356 16 00            [ 7]  572 	ld	d, #0x00
      000358 6B               [ 4]  573 	ld	l, e
      000359 62               [ 4]  574 	ld	h, d
      00035A 29               [11]  575 	add	hl, hl
      00035B 19               [11]  576 	add	hl, de
      00035C 29               [11]  577 	add	hl, hl
      00035D 29               [11]  578 	add	hl, hl
      00035E EB               [ 4]  579 	ex	de, hl
      00035F DD 7E F4         [19]  580 	ld	a, -12 (ix)
      000362 83               [ 4]  581 	add	a, e
      000363 5F               [ 4]  582 	ld	e, a
      000364 DD 7E F5         [19]  583 	ld	a, -11 (ix)
      000367 8A               [ 4]  584 	adc	a, d
      000368 57               [ 4]  585 	ld	d, a
      000369 21 08 00         [10]  586 	ld	hl, #0x0008
      00036C 19               [11]  587 	add	hl, de
      00036D 36 00            [10]  588 	ld	(hl), #0x00
                                    589 ;../generic/usbdisk.c:142: for (cnt=0;cnt<8;cnt++)
      00036F DD 73 FA         [19]  590 	ld	-6 (ix), e
      000372 DD 72 FB         [19]  591 	ld	-5 (ix), d
      000375 DD 36 FF 00      [19]  592 	ld	-1 (ix), #0
      000379                        593 00146$:
                                    594 ;../generic/usbdisk.c:144: putchar (tolower(info.DIR_Name[cnt]));
      000379 DD 7E F6         [19]  595 	ld	a, -10 (ix)
      00037C DD 86 FF         [19]  596 	add	a, -1 (ix)
      00037F 5F               [ 4]  597 	ld	e, a
      000380 DD 7E F7         [19]  598 	ld	a, -9 (ix)
      000383 CE 00            [ 7]  599 	adc	a, #0x00
      000385 57               [ 4]  600 	ld	d, a
      000386 1A               [ 7]  601 	ld	a, (de)
      000387 6F               [ 4]  602 	ld	l, a
      000388 26 00            [ 7]  603 	ld	h, #0x00
      00038A C5               [11]  604 	push	bc
      00038B D5               [11]  605 	push	de
      00038C E5               [11]  606 	push	hl
      00038D CDr00r00         [17]  607 	call	_tolower
      000390 E3               [19]  608 	ex	(sp),hl
      000391 CDr00r00         [17]  609 	call	_putchar
      000394 F1               [10]  610 	pop	af
      000395 D1               [10]  611 	pop	de
      000396 C1               [10]  612 	pop	bc
                                    613 ;../generic/usbdisk.c:145: files[nr_dsk_files_found][cnt]=info.DIR_Name[cnt];
      000397 DD 7E FA         [19]  614 	ld	a, -6 (ix)
      00039A DD 86 FF         [19]  615 	add	a, -1 (ix)
      00039D DD 77 FC         [19]  616 	ld	-4 (ix), a
      0003A0 DD 7E FB         [19]  617 	ld	a, -5 (ix)
      0003A3 CE 00            [ 7]  618 	adc	a, #0x00
      0003A5 DD 77 FD         [19]  619 	ld	-3 (ix), a
      0003A8 1A               [ 7]  620 	ld	a, (de)
      0003A9 DD 6E FC         [19]  621 	ld	l, -4 (ix)
      0003AC DD 66 FD         [19]  622 	ld	h, -3 (ix)
      0003AF 77               [ 7]  623 	ld	(hl), a
                                    624 ;../generic/usbdisk.c:142: for (cnt=0;cnt<8;cnt++)
      0003B0 DD 34 FF         [23]  625 	inc	-1 (ix)
      0003B3 DD 7E FF         [19]  626 	ld	a, -1 (ix)
      0003B6 D6 08            [ 7]  627 	sub	a, #0x08
      0003B8 38 BF            [12]  628 	jr	C, 00146$
                                    629 ;../generic/usbdisk.c:147: putchar (' ');
      0003BA C5               [11]  630 	push	bc
      0003BB 21 20 00         [10]  631 	ld	hl, #0x0020
      0003BE E5               [11]  632 	push	hl
      0003BF CDr00r00         [17]  633 	call	_putchar
      0003C2 21 20 00         [10]  634 	ld	hl, #0x0020
      0003C5 E3               [19]  635 	ex	(sp),hl
      0003C6 CDr00r00         [17]  636 	call	_putchar
      0003C9 21 20 00         [10]  637 	ld	hl, #0x0020
      0003CC E3               [19]  638 	ex	(sp),hl
      0003CD CDr00r00         [17]  639 	call	_putchar
      0003D0 21 20 00         [10]  640 	ld	hl, #0x0020
      0003D3 E3               [19]  641 	ex	(sp),hl
      0003D4 CDr00r00         [17]  642 	call	_putchar
      0003D7 F1               [10]  643 	pop	af
      0003D8 C1               [10]  644 	pop	bc
                                    645 ;../generic/usbdisk.c:151: nr_dsk_files_found++;
      0003D9 DD 34 FE         [23]  646 	inc	-2 (ix)
                                    647 ;../generic/usbdisk.c:152: if ((nr_dsk_files_found%nr_dsks_per_line) == 0)
      0003DC C5               [11]  648 	push	bc
      0003DD DD 66 F3         [19]  649 	ld	h, -13 (ix)
      0003E0 DD 6E FE         [19]  650 	ld	l, -2 (ix)
      0003E3 E5               [11]  651 	push	hl
      0003E4 CDr00r00         [17]  652 	call	__moduchar
      0003E7 F1               [10]  653 	pop	af
      0003E8 7D               [ 4]  654 	ld	a, l
      0003E9 C1               [10]  655 	pop	bc
      0003EA B7               [ 4]  656 	or	a, a
      0003EB 20 11            [12]  657 	jr	NZ, 00129$
                                    658 ;../generic/usbdisk.c:154: putchar ('\r');
      0003ED C5               [11]  659 	push	bc
      0003EE 21 0D 00         [10]  660 	ld	hl, #0x000d
      0003F1 E5               [11]  661 	push	hl
      0003F2 CDr00r00         [17]  662 	call	_putchar
      0003F5 21 0A 00         [10]  663 	ld	hl, #0x000a
      0003F8 E3               [19]  664 	ex	(sp),hl
      0003F9 CDr00r00         [17]  665 	call	_putchar
      0003FC F1               [10]  666 	pop	af
      0003FD C1               [10]  667 	pop	bc
      0003FE                        668 00129$:
                                    669 ;../generic/usbdisk.c:160: while (ch376_next_search () && nr_dsk_files_found<MAX_FILES);
      0003FE C5               [11]  670 	push	bc
      0003FF CDr00r00         [17]  671 	call	_ch376_next_search
      000402 C1               [10]  672 	pop	bc
      000403 CB 45            [ 8]  673 	bit	0, l
      000405 28 08            [12]  674 	jr	Z, 00130$
      000407 DD 7E FE         [19]  675 	ld	a, -2 (ix)
      00040A D6 1A            [ 7]  676 	sub	a, #0x1a
      00040C DAr1Er02         [10]  677 	jp	C, 00128$
      00040F                        678 00130$:
                                    679 ;../generic/usbdisk.c:161: putchar ('\r');
      00040F C5               [11]  680 	push	bc
      000410 21 0D 00         [10]  681 	ld	hl, #0x000d
      000413 E5               [11]  682 	push	hl
      000414 CDr00r00         [17]  683 	call	_putchar
      000417 21 0A 00         [10]  684 	ld	hl, #0x000a
      00041A E3               [19]  685 	ex	(sp),hl
      00041B CDr00r00         [17]  686 	call	_putchar
      00041E 21rF4r04         [10]  687 	ld	hl, #___str_21
      000421 E3               [19]  688 	ex	(sp),hl
      000422 CDr00r00         [17]  689 	call	_puts
      000425 F1               [10]  690 	pop	af
      000426 CDr00r00         [17]  691 	call	_getchar
      000429 C1               [10]  692 	pop	bc
                                    693 ;../generic/usbdisk.c:166: c = toupper (c);
      00042A 26 00            [ 7]  694 	ld	h, #0x00
      00042C C5               [11]  695 	push	bc
      00042D E5               [11]  696 	push	hl
      00042E CDr00r00         [17]  697 	call	_toupper
      000431 F1               [10]  698 	pop	af
      000432 C1               [10]  699 	pop	bc
                                    700 ;../generic/usbdisk.c:167: if (c>='A' && c<='A'+nr_dsk_files_found)
      000433 DD 75 FF         [19]  701 	ld	-1 (ix), l
      000436 7D               [ 4]  702 	ld	a, l
      000437 D6 41            [ 7]  703 	sub	a, #0x41
      000439 38 64            [12]  704 	jr	C, 00140$
      00043B DD 5E FE         [19]  705 	ld	e, -2 (ix)
      00043E 16 00            [ 7]  706 	ld	d, #0x00
      000440 21 41 00         [10]  707 	ld	hl, #0x0041
      000443 19               [11]  708 	add	hl, de
      000444 DD 5E FF         [19]  709 	ld	e, -1 (ix)
      000447 16 00            [ 7]  710 	ld	d, #0x00
      000449 7D               [ 4]  711 	ld	a, l
      00044A 93               [ 4]  712 	sub	a, e
      00044B 7C               [ 4]  713 	ld	a, h
      00044C 9A               [ 4]  714 	sbc	a, d
      00044D E2r52r04         [10]  715 	jp	PO, 00285$
      000450 EE 80            [ 7]  716 	xor	a, #0x80
      000452                        717 00285$:
      000452 FAr9Fr04         [10]  718 	jp	M, 00140$
                                    719 ;../generic/usbdisk.c:169: c-='A';
      000455 DD 7E FF         [19]  720 	ld	a, -1 (ix)
      000458 C6 BF            [ 7]  721 	add	a, #0xbf
                                    722 ;../generic/usbdisk.c:170: if (files[c][8]=='\0')
      00045A 5F               [ 4]  723 	ld	e, a
      00045B 16 00            [ 7]  724 	ld	d, #0x00
      00045D 6B               [ 4]  725 	ld	l, e
      00045E 62               [ 4]  726 	ld	h, d
      00045F 29               [11]  727 	add	hl, hl
      000460 19               [11]  728 	add	hl, de
      000461 29               [11]  729 	add	hl, hl
      000462 29               [11]  730 	add	hl, hl
      000463 09               [11]  731 	add	hl, bc
      000464 EB               [ 4]  732 	ex	de, hl
      000465 4B               [ 4]  733 	ld	c, e
      000466 42               [ 4]  734 	ld	b, d
      000467 21 08 00         [10]  735 	ld	hl, #8
      00046A 09               [11]  736 	add	hl, bc
      00046B 7E               [ 7]  737 	ld	a, (hl)
                                    738 ;../generic/usbdisk.c:176: return usbdisk_select_dsk_file (files[c]);
      00046C 4B               [ 4]  739 	ld	c, e
      00046D 42               [ 4]  740 	ld	b, d
                                    741 ;../generic/usbdisk.c:170: if (files[c][8]=='\0')
      00046E B7               [ 4]  742 	or	a, a
      00046F 20 16            [12]  743 	jr	NZ, 00137$
                                    744 ;../generic/usbdisk.c:173: if (files[c][0]=='.')
      000471 1A               [ 7]  745 	ld	a, (de)
      000472 D6 2E            [ 7]  746 	sub	a, #0x2e
      000474 20 0A            [12]  747 	jr	NZ, 00132$
                                    748 ;../generic/usbdisk.c:174: return usbdisk_select_dsk_file ("/");
      000476 21rF6r04         [10]  749 	ld	hl, #___str_22
      000479 E5               [11]  750 	push	hl
      00047A CDr8Er01         [17]  751 	call	_usbdisk_select_dsk_file
      00047D F1               [10]  752 	pop	af
      00047E 18 2A            [12]  753 	jr	00148$
      000480                        754 00132$:
                                    755 ;../generic/usbdisk.c:176: return usbdisk_select_dsk_file (files[c]);
      000480 C5               [11]  756 	push	bc
      000481 CDr8Er01         [17]  757 	call	_usbdisk_select_dsk_file
      000484 F1               [10]  758 	pop	af
      000485 18 23            [12]  759 	jr	00148$
      000487                        760 00137$:
                                    761 ;../generic/usbdisk.c:181: ch376_set_filename (files[c]);
      000487 C5               [11]  762 	push	bc
      000488 CDr00r00         [17]  763 	call	_ch376_set_filename
      00048B F1               [10]  764 	pop	af
                                    765 ;../generic/usbdisk.c:182: if (!ch376_open_file ())
      00048C CDr00r00         [17]  766 	call	_ch376_open_file
      00048F CB 45            [ 8]  767 	bit	0, l
      000491 20 08            [12]  768 	jr	NZ, 00135$
                                    769 ;../generic/usbdisk.c:183: error ("-DSK not opened\r\n");
      000493 21rF8r04         [10]  770 	ld	hl, #___str_23
      000496 E5               [11]  771 	push	hl
      000497 CDr00r00         [17]  772 	call	_error
      00049A F1               [10]  773 	pop	af
      00049B                        774 00135$:
                                    775 ;../generic/usbdisk.c:184: return DSK_IMAGE;
      00049B 2E 02            [ 7]  776 	ld	l, #0x02
      00049D 18 0B            [12]  777 	jr	00148$
      00049F                        778 00140$:
                                    779 ;../generic/usbdisk.c:187: if (c=='2')
      00049F DD 7E FF         [19]  780 	ld	a, -1 (ix)
      0004A2 D6 32            [ 7]  781 	sub	a, #0x32
                                    782 ;../generic/usbdisk.c:188: return USB;
                                    783 ;../generic/usbdisk.c:190: return FLOPPY;
      0004A4 2E 01            [ 7]  784 	ld	l, #0x01
      0004A6 28 02            [12]  785 	jr	Z, 00148$
      0004A8 2E 00            [ 7]  786 	ld	l, #0x00
      0004AA                        787 00148$:
                                    788 ;../generic/usbdisk.c:191: }
      0004AA DD F9            [10]  789 	ld	sp, ix
      0004AC DD E1            [14]  790 	pop	ix
      0004AE C9               [10]  791 	ret
      0004AF                        792 ___str_12:
      0004AF 2D 44 69 72 65 63 74   793 	.ascii "-Directory not opened"
             6F 72 79 20 6E 6F 74
             20 6F 70 65 6E 65 64
      0004C4 00                     794 	.db 0x00
      0004C5                        795 ___str_17:
      0004C5 2A                     796 	.ascii "*"
      0004C6 00                     797 	.db 0x00
      0004C7                        798 ___str_18:
      0004C7 2D 4E 6F 20 66 69 6C   799 	.ascii "-No files found"
             65 73 20 66 6F 75 6E
             64
      0004D6 00                     800 	.db 0x00
      0004D7                        801 ___str_19:
      0004D7 4F 72 2C 20 73 65 6C   802 	.ascii "Or, select DSK image [%s]:"
             65 63 74 20 44 53 4B
             20 69 6D 61 67 65 20
             5B 25 73 5D 3A
      0004F1 0D                     803 	.db 0x0d
      0004F2 0A                     804 	.db 0x0a
      0004F3 00                     805 	.db 0x00
      0004F4                        806 ___str_21:
      0004F4 0D                     807 	.db 0x0d
      0004F5 00                     808 	.db 0x00
      0004F6                        809 ___str_22:
      0004F6 2F                     810 	.ascii "/"
      0004F7 00                     811 	.db 0x00
      0004F8                        812 ___str_23:
      0004F8 2D 44 53 4B 20 6E 6F   813 	.ascii "-DSK not opened"
             74 20 6F 70 65 6E 65
             64
      000507 0D                     814 	.db 0x0d
      000508 0A                     815 	.db 0x0a
      000509 00                     816 	.db 0x00
      00050A                        817 ___str_24:
      00050A 0D                     818 	.db 0x0d
      00050B 0A                     819 	.db 0x0a
      00050C 53 65 6C 65 63 74 20   820 	.ascii "Select device:"
             64 65 76 69 63 65 3A
      00051A 0D                     821 	.db 0x0d
      00051B 0A                     822 	.db 0x0a
      00051C 31 2E 46 4C 4F 50 50   823 	.ascii "1.FLOPPY       2.USBDRIVE"
             59 20 20 20 20 20 20
             20 32 2E 55 53 42 44
             52 49 56 45
      000535 0D                     824 	.db 0x0d
      000536 0A                     825 	.db 0x0a
      000537 0D                     826 	.db 0x0d
      000538 00                     827 	.db 0x00
                                    828 ;../generic/usbdisk.c:193: bool read_write_file_sectors (bool writing,uint8_t nr_sectors,uint32_t* sector,uint8_t* sector_buffer)
                                    829 ;	---------------------------------
                                    830 ; Function read_write_file_sectors
                                    831 ; ---------------------------------
      000539                        832 _read_write_file_sectors::
      000539 21 F6 FF         [10]  833 	ld	hl, #-10
      00053C 39               [11]  834 	add	hl, sp
      00053D F9               [ 6]  835 	ld	sp, hl
                                    836 ;../generic/usbdisk.c:196: if (!ch376_locate_sector ((uint8_t*)sector))
      00053E 21 0E 00         [10]  837 	ld	hl, #14
      000541 39               [11]  838 	add	hl, sp
      000542 4E               [ 7]  839 	ld	c, (hl)
      000543 23               [ 6]  840 	inc	hl
      000544 46               [ 7]  841 	ld	b, (hl)
      000545 C5               [11]  842 	push	bc
      000546 CDr00r00         [17]  843 	call	_ch376_locate_sector
      000549 F1               [10]  844 	pop	af
      00054A 4D               [ 4]  845 	ld	c, l
      00054B CB 41            [ 8]  846 	bit	0, c
      00054D 20 05            [12]  847 	jr	NZ, 00102$
                                    848 ;../generic/usbdisk.c:197: return false;
      00054F 2E 00            [ 7]  849 	ld	l, #0x00
      000551 C3rD5r05         [10]  850 	jp	00112$
      000554                        851 00102$:
                                    852 ;../generic/usbdisk.c:198: if (!ch376_get_sector_LBA (nr_sectors,(uint8_t*) &sectors_lba))
      000554 21 00 00         [10]  853 	ld	hl, #0
      000557 39               [11]  854 	add	hl, sp
      000558 7D               [ 4]  855 	ld	a, l
      000559 FD 21 08 00      [14]  856 	ld	iy, #8
      00055D FD 39            [15]  857 	add	iy, sp
      00055F FD 77 00         [19]  858 	ld	0 (iy), a
      000562 FD 74 01         [19]  859 	ld	1 (iy), h
      000565 FD 4E 00         [19]  860 	ld	c, 0 (iy)
      000568 FD 46 01         [19]  861 	ld	b, 1 (iy)
      00056B C5               [11]  862 	push	bc
      00056C 21 0F 00         [10]  863 	ld	hl, #15
      00056F 39               [11]  864 	add	hl, sp
      000570 7E               [ 7]  865 	ld	a, (hl)
      000571 F5               [11]  866 	push	af
      000572 33               [ 6]  867 	inc	sp
      000573 CDr00r00         [17]  868 	call	_ch376_get_sector_LBA
      000576 F1               [10]  869 	pop	af
      000577 33               [ 6]  870 	inc	sp
      000578 CB 45            [ 8]  871 	bit	0, l
      00057A 20 04            [12]  872 	jr	NZ, 00104$
                                    873 ;../generic/usbdisk.c:199: return false;
      00057C 2E 00            [ 7]  874 	ld	l, #0x00
      00057E 18 55            [12]  875 	jr	00112$
      000580                        876 00104$:
                                    877 ;../generic/usbdisk.c:202: if (!ch376s_disk_read (sectors_lba[0],sectors_lba+4,sector_buffer))
      000580 FD 21 08 00      [14]  878 	ld	iy, #8
      000584 FD 39            [15]  879 	add	iy, sp
      000586 FD 7E 00         [19]  880 	ld	a, 0 (iy)
      000589 C6 04            [ 7]  881 	add	a, #0x04
      00058B 4F               [ 4]  882 	ld	c, a
      00058C FD 7E 01         [19]  883 	ld	a, 1 (iy)
      00058F CE 00            [ 7]  884 	adc	a, #0x00
      000591 FD 6E 00         [19]  885 	ld	l, 0 (iy)
      000594 FD 66 01         [19]  886 	ld	h, 1 (iy)
      000597 56               [ 7]  887 	ld	d, (hl)
      000598 47               [ 4]  888 	ld	b, a
                                    889 ;../generic/usbdisk.c:200: if (!writing)
      000599 21 0C 00         [10]  890 	ld	hl, #12
      00059C 39               [11]  891 	add	hl, sp
      00059D CB 46            [12]  892 	bit	0, (hl)
      00059F 20 1A            [12]  893 	jr	NZ, 00110$
                                    894 ;../generic/usbdisk.c:202: if (!ch376s_disk_read (sectors_lba[0],sectors_lba+4,sector_buffer))
      0005A1 21 10 00         [10]  895 	ld	hl, #16
      0005A4 39               [11]  896 	add	hl, sp
      0005A5 7E               [ 7]  897 	ld	a, (hl)
      0005A6 23               [ 6]  898 	inc	hl
      0005A7 66               [ 7]  899 	ld	h, (hl)
      0005A8 6F               [ 4]  900 	ld	l, a
      0005A9 E5               [11]  901 	push	hl
      0005AA C5               [11]  902 	push	bc
      0005AB D5               [11]  903 	push	de
      0005AC 33               [ 6]  904 	inc	sp
      0005AD CDr00r00         [17]  905 	call	_ch376s_disk_read
      0005B0 F1               [10]  906 	pop	af
      0005B1 F1               [10]  907 	pop	af
      0005B2 33               [ 6]  908 	inc	sp
      0005B3 CB 45            [ 8]  909 	bit	0, l
      0005B5 20 1C            [12]  910 	jr	NZ, 00111$
                                    911 ;../generic/usbdisk.c:203: return false;
      0005B7 2E 00            [ 7]  912 	ld	l, #0x00
      0005B9 18 1A            [12]  913 	jr	00112$
      0005BB                        914 00110$:
                                    915 ;../generic/usbdisk.c:207: if (!ch376s_disk_write (sectors_lba[0],sectors_lba+4,sector_buffer))
      0005BB 21 10 00         [10]  916 	ld	hl, #16
      0005BE 39               [11]  917 	add	hl, sp
      0005BF 7E               [ 7]  918 	ld	a, (hl)
      0005C0 23               [ 6]  919 	inc	hl
      0005C1 66               [ 7]  920 	ld	h, (hl)
      0005C2 6F               [ 4]  921 	ld	l, a
      0005C3 E5               [11]  922 	push	hl
      0005C4 C5               [11]  923 	push	bc
      0005C5 D5               [11]  924 	push	de
      0005C6 33               [ 6]  925 	inc	sp
      0005C7 CDr00r00         [17]  926 	call	_ch376s_disk_write
      0005CA F1               [10]  927 	pop	af
      0005CB F1               [10]  928 	pop	af
      0005CC 33               [ 6]  929 	inc	sp
      0005CD CB 45            [ 8]  930 	bit	0, l
                                    931 ;../generic/usbdisk.c:208: return false;
                                    932 ;../generic/usbdisk.c:211: return true;
      0005CF 2E 00            [ 7]  933 	ld	l, #0x00
      0005D1 28 02            [12]  934 	jr	Z, 00112$
      0005D3                        935 00111$:
      0005D3 2E 01            [ 7]  936 	ld	l, #0x01
      0005D5                        937 00112$:
                                    938 ;../generic/usbdisk.c:212: }
      0005D5 FD 21 0A 00      [14]  939 	ld	iy, #10
      0005D9 FD 39            [15]  940 	add	iy, sp
      0005DB FD F9            [10]  941 	ld	sp, iy
      0005DD C9               [10]  942 	ret
                                    943 ;../generic/usbdisk.c:214: bool read_write_disk_sectors (bool writing,uint8_t nr_sectors,uint32_t* sector,uint8_t* sector_buffer)
                                    944 ;	---------------------------------
                                    945 ; Function read_write_disk_sectors
                                    946 ; ---------------------------------
      0005DE                        947 _read_write_disk_sectors::
      0005DE DD E5            [15]  948 	push	ix
      0005E0 DD 21 00 00      [14]  949 	ld	ix,#0
      0005E4 DD 39            [15]  950 	add	ix,sp
                                    951 ;../generic/usbdisk.c:218: if (!ch376s_disk_read (nr_sectors,(uint8_t*)sector,sector_buffer))
      0005E6 DD 4E 06         [19]  952 	ld	c, 6 (ix)
      0005E9 DD 46 07         [19]  953 	ld	b, 7 (ix)
                                    954 ;../generic/usbdisk.c:216: if (!writing)
      0005EC DD CB 04 46      [20]  955 	bit	0, 4 (ix)
      0005F0 20 1B            [12]  956 	jr	NZ, 00106$
                                    957 ;../generic/usbdisk.c:218: if (!ch376s_disk_read (nr_sectors,(uint8_t*)sector,sector_buffer))
      0005F2 DD 6E 08         [19]  958 	ld	l, 8 (ix)
      0005F5 DD 66 09         [19]  959 	ld	h, 9 (ix)
      0005F8 E5               [11]  960 	push	hl
      0005F9 C5               [11]  961 	push	bc
      0005FA DD 7E 05         [19]  962 	ld	a, 5 (ix)
      0005FD F5               [11]  963 	push	af
      0005FE 33               [ 6]  964 	inc	sp
      0005FF CDr00r00         [17]  965 	call	_ch376s_disk_read
      000602 F1               [10]  966 	pop	af
      000603 F1               [10]  967 	pop	af
      000604 33               [ 6]  968 	inc	sp
      000605 CB 45            [ 8]  969 	bit	0, l
      000607 20 1D            [12]  970 	jr	NZ, 00107$
                                    971 ;../generic/usbdisk.c:219: return false;
      000609 2E 00            [ 7]  972 	ld	l, #0x00
      00060B 18 1B            [12]  973 	jr	00108$
      00060D                        974 00106$:
                                    975 ;../generic/usbdisk.c:223: if (!ch376s_disk_write (nr_sectors,(uint8_t*)sector,sector_buffer))
      00060D DD 6E 08         [19]  976 	ld	l, 8 (ix)
      000610 DD 66 09         [19]  977 	ld	h, 9 (ix)
      000613 E5               [11]  978 	push	hl
      000614 C5               [11]  979 	push	bc
      000615 DD 7E 05         [19]  980 	ld	a, 5 (ix)
      000618 F5               [11]  981 	push	af
      000619 33               [ 6]  982 	inc	sp
      00061A CDr00r00         [17]  983 	call	_ch376s_disk_write
      00061D F1               [10]  984 	pop	af
      00061E F1               [10]  985 	pop	af
      00061F 33               [ 6]  986 	inc	sp
      000620 CB 45            [ 8]  987 	bit	0, l
                                    988 ;../generic/usbdisk.c:224: return false;
                                    989 ;../generic/usbdisk.c:227: return true;
      000622 2E 00            [ 7]  990 	ld	l, #0x00
      000624 28 02            [12]  991 	jr	Z, 00108$
      000626                        992 00107$:
      000626 2E 01            [ 7]  993 	ld	l, #0x01
      000628                        994 00108$:
                                    995 ;../generic/usbdisk.c:228: }
      000628 DD E1            [14]  996 	pop	ix
      00062A C9               [10]  997 	ret
                                    998 ;../generic/usbdisk.c:230: bool usbdisk_close_dsk_file ()
                                    999 ;	---------------------------------
                                   1000 ; Function usbdisk_close_dsk_file
                                   1001 ; ---------------------------------
      00062B                       1002 _usbdisk_close_dsk_file::
                                   1003 ;../generic/usbdisk.c:232: return ch376_close_file();
                                   1004 ;../generic/usbdisk.c:233: }
      00062B C3r00r00         [10] 1005 	jp	_ch376_close_file
                                   1006 	.area _CODE
                                   1007 	.area _INITIALIZER
                                   1008 	.area _CABS (ABS)
